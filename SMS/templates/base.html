<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}School Management System{% endblock %}</title>

    <!-- Bootstrap 5 CSS + Icons + Animate.css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    {% include 'includes/style.html' %}

    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Mobile sidebar overlay -->
    {% if not "accounts" in request.path and "tenants" not in request.path %}
    <div id="sidebar-overlay"></div>
    {% endif %}

    <div class="wrapper">
        <div class="content-row">

            <!-- SIDEBAR -->
            {% if not "accounts" in request.path and "tenants" not in request.path %}
            {% include 'includes/sidebar.html' %}
            {% endif %}

            <!-- MAIN CONTENT -->
            <div class="main-content">
                {% if not "accounts" in request.path and "tenants" not in request.path %}
                {% include 'includes/header.html' %}
                {% endif %}

                <main class="page-content">
                    {% block content %}{% endblock %}
                </main>

                {% include 'includes/footer.html' %}
            </div>

        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Mobile sidebar controller -->
    <script>
        (function () {
            var sidebar = document.getElementById('appSidebar');
            var overlay = document.getElementById('sidebar-overlay');
            var toggleBtn = document.getElementById('sidebarToggleBtn');

            if (!sidebar || !overlay || !toggleBtn) return;

            function openSidebar() {
                overlay.classList.add('show');
                /* Force reflow before adding visible for transition to fire */
                overlay.getBoundingClientRect();
                overlay.classList.add('visible');
                sidebar.classList.add('mobile-open');
                document.body.style.overflow = 'hidden';
            }

            function closeSidebar() {
                overlay.classList.remove('visible');
                sidebar.classList.remove('mobile-open');
                document.body.style.overflow = '';
                /* Wait for fade-out then hide */
                setTimeout(function () {
                    overlay.classList.remove('show');
                }, 260);
            }

            toggleBtn.addEventListener('click', function () {
                if (sidebar.classList.contains('mobile-open')) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            });

            overlay.addEventListener('click', closeSidebar);

            /* Close sidebar on nav link click (mobile) */
            if (sidebar) {
                sidebar.querySelectorAll('a.nav-link:not([data-bs-toggle])').forEach(function (link) {
                    link.addEventListener('click', function () {
                        if (window.innerWidth < 992) {
                            closeSidebar();
                        }
                    });
                });
            }
        })();
    </script>

    {% block extra_js %}{% endblock %}
</body>

</html>