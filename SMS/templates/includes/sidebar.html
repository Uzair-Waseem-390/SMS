{% load school_urls %}
<aside class="sidebar animate__animated animate__fadeInLeft">
    <div class="school-brand">
        <i class="bi bi-building"></i>
        <span>EduSaaS</span>
    </div>

    <!-- Branch Switcher (Principal Only) -->
    {% if principal_branches|length > 1 %}
    <div class="px-3 py-2" style="background: #1a2332;">
        <small class="text-white-50 d-block mb-1"><i class="bi bi-diagram-3 me-1"></i>Active Branch</small>
        <div class="dropdown">
            <button class="btn btn-sm btn-outline-light w-100 dropdown-toggle text-start" type="button"
                data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-building me-1"></i>
                {{ current_branch.name|default:"Select Branch" }}
            </button>
            <ul class="dropdown-menu dropdown-menu-dark w-100" style="max-height: 250px; overflow-y: auto;">
                {% for b in principal_branches %}
                <li>
                    <a class="dropdown-item {% if current_branch.id == b.id %}active{% endif %}"
                        href="{% url 'tenants:switch_branch' %}?branch_id={{ b.id }}">
                        {% if b.is_main_branch %}<i class="bi bi-star-fill text-warning me-1"></i>{% endif %}
                        {{ b.name }}
                        {% if current_branch.id == b.id %}<i class="bi bi-check2 ms-auto"></i>{% endif %}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% elif current_branch %}
    <div class="px-3 py-2 text-center" style="background: #1a2332;">
        <small class="text-white-50">{{ current_school.name }}</small><br>
        <span class="badge bg-primary">{{ current_branch.name }}</span>
    </div>
    {% endif %}

    <nav class="nav flex-column">
        <a class="nav-link" href="{% sb_url 'dashboard:index' %}"><i class="bi bi-speedometer2"></i> Dashboard</a>

        <div class="sidebar-divider"></div>

        <a class="nav-link d-flex justify-content-between align-items-center {% if not request.resolver_match or 'academics' not in request.resolver_match.app_name %}collapsed{% endif %}"
            data-bs-toggle="collapse" href="#academicsSubmenu" role="button"
            aria-expanded="{% if request.resolver_match and 'academics' in request.resolver_match.app_name %}true{% else %}false{% endif %}"
            aria-controls="academicsSubmenu">
            <span><i class="bi bi-book"></i> Academics</span>
            <i class="bi bi-chevron-down" style="font-size: 0.8rem;"></i>
        </a>
        <div class="collapse {% if request.resolver_match and 'academics' in request.resolver_match.app_name %}show{% endif %}"
            id="academicsSubmenu">
            <nav class="nav flex-column ms-3 border-start border-secondary ps-2 my-1">
                <a class="nav-link py-1 {% if 'class' in request.resolver_match.url_name %}active{% endif %}"
                    href="{% sb_url 'academics:class_list' %}">
                    <small>Classes & Sections</small>
                </a>
                <a class="nav-link py-1 {% if 'subject' in request.resolver_match.url_name %}active{% endif %}"
                    href="{% sb_url 'academics:subject_list' %}">
                    <small>Subjects</small>
                </a>
            </nav>
        </div>
        <a class="nav-link" href="{% sb_url 'students:student_list' %}"><i class="bi bi-people"></i> Students</a>
        <a class="nav-link" href="{% sb_url 'staff:staff_list' %}"><i class="bi bi-person-badge"></i> Staff</a>
        <a class="nav-link" href="{% sb_url 'attendance:bulk_staff_attendance' %}"><i class="bi bi-calendar-check"></i>
            Attendance</a>
        <a class="nav-link" href="{% sb_url 'exams:exam_list' %}"><i class="bi bi-bar-chart"></i> Exams & Results</a>

        <div class="sidebar-divider"></div>

        <a class="nav-link" href="{% sb_url 'finance:dashboard' %}"><i class="bi bi-cash-stack"></i> Finance</a>
        <a class="nav-link" href="{% sb_url 'notification:notification_list' %}"><i class="bi bi-bell"></i>
            Notifications</a>
        <a class="nav-link" href="{% sb_url 'certificate:template_list' %}"><i class="bi bi-award"></i> Certificates</a>

        <div class="sidebar-divider"></div>

        {% if request.user.user_type == 'principal' %}
        <a class="nav-link" href="{% url 'tenants:school_detail' %}"><i class="bi bi-building-gear"></i> School
            Settings</a>
        <a class="nav-link" href="{% url 'tenants:branch_list' %}"><i class="bi bi-diagram-3"></i> Manage Branches</a>
        <div class="sidebar-divider"></div>
        {% endif %}

        <a class="nav-link" href="{% url 'accounts:profile' %}"><i class="bi bi-person-circle"></i> My Profile</a>
        <a class="nav-link" href="{% url 'accounts:logout' %}"><i class="bi bi-box-arrow-right"></i> Logout</a>
    </nav>

    {% if current_school %}
    <div class="mt-4 p-3 bg-dark text-white rounded-3" style="background: #1e2b38 !important;">
        <small><i class="bi bi-stars"></i> School: <strong>{{ current_school.name }}</strong></small><br>
        <small>Branch: {{ current_branch.name }}</small>
    </div>
    {% endif %}
</aside>